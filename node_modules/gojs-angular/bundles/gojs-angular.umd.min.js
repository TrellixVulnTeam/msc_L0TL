!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("gojs")):"function"==typeof define&&define.amd?define("gojs-angular",["exports","@angular/core","gojs"],t):t((e=e||self)["gojs-angular"]={},e.ng.core,e.go)}(this,(function(e,t,a){"use strict";var i=function(){function e(e,a){this._kvdiffers=e,this.zone=a,this.linkDataArray=null,this.modelData=null,this.modelChangedListener=null,this.skipsDiagramUpdate=!1,this.modelChange=new t.EventEmitter,this.diagram=null,this._ndaDiffer=this._kvdiffers.find([]).create(),this._ldaDiffer=this._kvdiffers.find([]).create(),this._mdaDiffer=this._kvdiffers.find([]).create()}return e.prototype.ngAfterViewInit=function(){var e=this;this.diagram=this.initDiagram(),this.diagram.addEventListener=function(t,i,r,n){var o=a.Diagram.prototype.addEventListener;"mousemove"===i?e.zone.runOutsideAngular((function(){return o.call(e,t,i,r,n)})):e.zone.run((function(){o.call(e,t,i,r,n)}))};var t=this.diagramDiv.nativeElement;null!==t&&(this.diagram.div=t,this.diagram.delayInitialization((function(){e.diagram.model.commit((function(t){t.mergeNodeDataArray(t.cloneDeep(e.nodeDataArray)),e.linkDataArray&&t instanceof a.GraphLinksModel&&t.mergeLinkDataArray(t.cloneDeep(e.linkDataArray)),e.modelData&&t.assignAllDataProperties(t.modelData,e.modelData),e.diagram.layoutDiagram(!0)}),null)})),this.modelChangedListener=function(t){t.isTransactionFinished&&e.diagram&&e.diagram.model&&!e.diagram.model.isReadOnly&&e.zone.run((function(){var a=t.model.toIncrementalData(t);e.modelChange.emit(a)}))},this.diagram.addModelChangedListener(this.modelChangedListener))},e.mergeChanges=function(t,a,i){var r=t instanceof e?t.diagram:t.palette;r&&r.model&&a&&(a.forEachAddedItem((function(e){switch(i){case"n":r.model.addNodeData(e.currentValue);break;case"l":r.model.addLinkData(e.currentValue)}})),a.forEachRemovedItem((function(e){switch(i){case"n":var t=r.model.nodeKeyProperty.toString(),a=r.findNodeForKey(e.previousValue[t]);a&&r.remove(a);break;case"l":var n=r.model.linkKeyProperty.toString(),o=r.findLinkForKey(e.previousValue[n]);o&&r.remove(o)}})),a.forEachChangedItem((function(e){if(!function e(t,a){if(!t||!a)return!1;for(var i in t){if(t.hasOwnProperty(i)!==a.hasOwnProperty(i))return!1;switch(typeof t[i]){case"object":if(!e(t[i],a[i]))return!1;break;default:if(t[i]!==a[i])return!1}}for(var i in a)if(void 0===t[i])return!1;return!0}(e.currentValue,e.previousValue))switch(i){case"n":var t=r.model.nodeKeyProperty.toString(),a=r.findNodeForKey(e.previousValue[t]);a&&(e.currentValue?r.model.assignAllDataProperties(a.data,e.currentValue):r.remove(a));break;case"l":var n=r.model.linkKeyProperty.toString(),o=r.findLinkForKey(e.previousValue[n]);o&&(e.currentValue?r.model.assignAllDataProperties(o.data,e.currentValue):r.remove(o))}})))},e.prototype.ngDoCheck=function(){if(this.diagram&&this.diagram.model){var t=this._ndaDiffer.diff(this.nodeDataArray),a=this._ldaDiffer.diff(this.linkDataArray),i=this._mdaDiffer.diff(this.modelData);(t||a||i)&&(this.skipsDiagramUpdate||(null!==this.modelChangedListener&&this.diagram.model.removeChangedListener(this.modelChangedListener),this.diagram.model.startTransaction("update data"),this.diagram.model.assignAllDataProperties(this.diagram.model.modelData,this.modelData),e.mergeChanges(this,t,"n"),e.mergeChanges(this,a,"l"),this.diagram.model.commitTransaction("update data"),null!==this.modelChangedListener&&this.diagram.model.addChangedListener(this.modelChangedListener)))}},e.prototype.ngOnDestroy=function(){this.diagram.div=null},e}();i.decorators=[{type:t.Component,args:[{selector:"gojs-diagram",template:"<div #ngDiagram [className]=divClassName></div>"}]}],i.ctorParameters=function(){return[{type:t.KeyValueDiffers},{type:t.NgZone}]},i.propDecorators={initDiagram:[{type:t.Input}],nodeDataArray:[{type:t.Input}],linkDataArray:[{type:t.Input}],modelData:[{type:t.Input}],divClassName:[{type:t.Input}],skipsDiagramUpdate:[{type:t.Input}],modelChange:[{type:t.Output}],diagramDiv:[{type:t.ViewChild,args:["ngDiagram",{static:!0}]}]};var r=function(){function e(e,a){this._kvdiffers=e,this.zone=a,this.linkDataArray=null,this.modelData=null,this.skipsPaletteUpdate=!1,this.modelChangedListener=null,this.modelChange=new t.EventEmitter,this.palette=null,this._ndaDiffer=this._kvdiffers.find([]).create(),this._ldaDiffer=this._kvdiffers.find([]).create(),this._mdaDiffer=this._kvdiffers.find([]).create()}return e.prototype.ngAfterViewInit=function(){var e=this;if(this.paletteDiv){this.palette=this.initPalette(),this.palette.addEventListener=function(t,i,r,n){var o=a.Diagram.prototype.addEventListener;"mousemove"===i?e.zone.runOutsideAngular((function(){return o.call(e,t,i,r,n)})):e.zone.run((function(){o.call(e,t,i,r,n)}))};var t=this.paletteDiv.nativeElement;this.palette.div=t,this.palette.delayInitialization((function(){e.palette.model.commit((function(t){t.mergeNodeDataArray(t.cloneDeep(e.nodeDataArray)),e.linkDataArray&&t instanceof a.GraphLinksModel&&t.mergeLinkDataArray(t.cloneDeep(e.linkDataArray)),e.modelData&&t.assignAllDataProperties(t.modelData,e.modelData),e.palette.layoutDiagram(!0)}),null)})),this.modelChangedListener=function(t){t.isTransactionFinished&&e.palette&&e.palette.model&&!e.palette.model.isReadOnly&&e.zone.run((function(){var a=t.model.toIncrementalData(t);e.modelChange.emit(a)}))},this.palette.addModelChangedListener(this.modelChangedListener)}},e.prototype.ngDoCheck=function(){if(this.palette&&this.palette.model){var e=this._ndaDiffer.diff(this.nodeDataArray),t=this._ldaDiffer.diff(this.linkDataArray),a=this._mdaDiffer.diff(this.modelData);(e||t||a)&&(this.skipsPaletteUpdate||(null!==this.modelChangedListener&&this.palette.model.removeChangedListener(this.modelChangedListener),this.palette.model.startTransaction("update data"),this.palette.model.assignAllDataProperties(this.palette.model.modelData,this.modelData),i.mergeChanges(this,e,"n"),i.mergeChanges(this,t,"l"),this.palette.model.commitTransaction("update data"),null!==this.modelChangedListener&&this.palette.model.addChangedListener(this.modelChangedListener)))}},e.prototype.ngOnDestroy=function(){this.palette.div=null},e}();r.decorators=[{type:t.Component,args:[{selector:"gojs-palette",template:"<div #ngPalette [className]=divClassName></div>"}]}],r.ctorParameters=function(){return[{type:t.KeyValueDiffers},{type:t.NgZone}]},r.propDecorators={initPalette:[{type:t.Input}],nodeDataArray:[{type:t.Input}],linkDataArray:[{type:t.Input}],modelData:[{type:t.Input}],divClassName:[{type:t.Input}],skipsPaletteUpdate:[{type:t.Input}],modelChange:[{type:t.Output}],paletteDiv:[{type:t.ViewChild,args:["ngPalette",{static:!0}]}]};var n=function(){function e(e){this.zone=e,this.observedDiagram=null,this.overview=null}return e.prototype.ngAfterViewInit=function(){var e=this;this.overviewDiv&&(this.initOverview?this.overview=this.initOverview():(this.overview=new a.Overview,this.overview.contentAlignment=a.Spot.Center),this.overview.addEventListener=function(t,i,r,n){var o=a.Diagram.prototype.addEventListener;"mousemove"===i?e.zone.runOutsideAngular((function(){return o.call(e,t,i,r,n)})):e.zone.run((function(){o.call(e,t,i,r,n)}))},this.overview.div=this.overviewDiv.nativeElement)},e.prototype.ngOnChanges=function(e){this.overview&&e&&e.observedDiagram&&e.observedDiagram.currentValue!==e.observedDiagram.previousValue&&(this.overview.observed=e.observedDiagram.currentValue)},e.prototype.ngOnDestroy=function(){this.overview.div=null},e}();n.decorators=[{type:t.Component,args:[{selector:"gojs-overview",template:"<div #ngOverview [className]=divClassName></div>"}]}],n.ctorParameters=function(){return[{type:t.NgZone}]},n.propDecorators={initOverview:[{type:t.Input}],divClassName:[{type:t.Input}],observedDiagram:[{type:t.Input}],overviewDiv:[{type:t.ViewChild,args:["ngOverview",{static:!0}]}]};var o=function(){function e(){}return e.syncNodeData=function(e,t,i){if(!e)return t;if(!e.modifiedNodeData&&!e.insertedNodeKeys&&!e.removedNodeKeys)return t;var r=new a.Map;return e.modifiedNodeData&&e.modifiedNodeData.forEach((function(e){var a=i?i.getKeyForNodeData(e):e.key;r.set(a,e);for(var n=0;n<t.length;n++){var o=t[n];(i?i.getKeyForNodeData(o):o.key)===a&&(t[n]=e)}})),e.insertedNodeKeys&&e.insertedNodeKeys.forEach((function(e){var a=r.get(e);a&&t.push(a)})),e.removedNodeKeys&&(t=t.filter((function(t){var a=i?i.getKeyForNodeData(t):t.key;return!e.removedNodeKeys.includes(a)}))),t},e.syncLinkData=function(e,t,i){if(!e)return t;if(!e.modifiedLinkData&&!e.insertedLinkKeys&&!e.removedLinkKeys)return t;var r=new a.Map;return e.modifiedLinkData&&e.modifiedLinkData.forEach((function(e){var a=i?i.getKeyForLinkData(e):e.key;r.set(a,e);for(var n=0;n<t.length;n++){var o=t[n];(i?i.getKeyForLinkData(o):o.key)===a&&(t[n]=e)}})),e.insertedLinkKeys&&e.insertedLinkKeys.forEach((function(e){var a=r.get(e);a&&t.push(a)})),e.removedLinkKeys&&(t=t.filter((function(t){var a=i?i.getKeyForLinkData(t):t.key;return!e.removedLinkKeys.includes(a)}))),t},e.syncModelData=function(e,t){return e&&e.modelData?e.modelData?e.modelData:void 0:t},e}();o.decorators=[{type:t.Injectable}],o.ctorParameters=function(){return[]};var s=function(){};s.decorators=[{type:t.NgModule,args:[{declarations:[i,n,r],imports:[],providers:[o],exports:[i,n,r]}]}],e.DataSyncService=o,e.DiagramComponent=i,e.GojsAngularModule=s,e.OverviewComponent=n,e.PaletteComponent=r,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=gojs-angular.umd.min.js.map